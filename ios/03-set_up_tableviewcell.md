# 講義3 画面要素の配置

この回では、 **投稿一覧画面** に並べて表示するセルの設定を行います。

Storyboard 上で、投稿されたメッセージを表示するセルを設定します。
設定が終わると以下の画像のようになります。

![](./images/20170801071954_img20170801-15-1pie31n.png)

## PostCell クラスのファイルを作成する

View グループの下に `PostCell` クラスのファイルを作成します。
`PostListViewController.swift` を作成した時と同様の操作をしてください。
その際に `UITableViewCell` のサブクラスとして作成してください。

ファイルが作成できたら Storyboard 上のセルを選択し、Custom Class の項目に作成したクラスを指定します。

![](./images/20170801072015_img20170801-15-1at8ue4.png)

また、つまみのようなタブに切り替えて、ReuseIdentifier に `PostCell` を指定してください。この値は次の回で使います。

![](./images/20170801072035_img20170801-15-1qu80c5.png)

## セルの高さを変更する

投稿メッセージを表示するセルの高さは最低 **80** point とすることにします。
投稿一覧画面の TableView を選択し、右ペインの TableView セクションの Row height の項目の値を **80** に設定します。

![](./images/20170801072051_img20170801-13-2xiqvi.png)

Row height の値を設定すると Storyboard 上の表示の高さも大きくなります。

![](./images/20170801072114_img20170801-18-t0t8pg.png)

## ラベルなどの要素の配置指定

今回設定するセルには以下の要素を配置する必要があります。

- 投稿者のアバター画像を表示する ImageView (avatarImageView)
- 投稿者名を表示する Label (authorNameLabel)
- 投稿時間を表示する Label (createDateLabel)
- 投稿の本文を表示する Label (bodyLabel)

それぞれの要素は以下のように配置します。

![](./images/20170801072130_img20170801-18-4u23do.png)

## 画像やラベルなどの要素を配置する

iOS には AutoLayout という、要素のサイズや要素間の間隔に対し制約を指定することでレイアウトを表現する仕組みがあります。
iOS 端末には複数の画面サイズや表示方向（Portlait/Landscape）があるので、画面サイズが違っても適切に要素が配置されるようにこの仕組みが用意されています。

また、StackView という画面要素を順に並べることでレイアウトを行う部品があります。
これから Storyboard 上で Label や ImageView を配置してしていきます。

### StackView の配置

まず、画面要素を配置するための大元の StackView を追加します。
上記のレイアウトを実現するために以下のような StackView の木構造を作ってレイアウトします

- StackView (青)
    - avatarImageView
    - StackView (緑)
        - StackView (橙)
            - authorNameLabel
            - createDateLabel
        - bodyLabel

![](./images/20170801072156_img20170801-22-ry03e5.png)

右ペイン下部から HorizontalStackView を選択し、セルにドラッグアンドドロップします。

![](./images/20170801072221_img20170801-18-1yqznwr.png)

ドラッグアンドドロップしただけでは意図したところに表示できないので制約を追加します。
ImageViewの大きさと上左のマージンを指定します。以下の画像のように設定してください。

![](./images/20170801072247_img20170801-24-rru773.png)

制約の設定ができると、それに合わせて追加したStackViewのレイアウトが変わります。

![](./images/20170801072309_img20170801-22-1lm4675.png)

最後に StackView の alignment を `Top` に変更します。Spacing にも `12` を指定してください。

![](./images/20170801072334_img20170801-21-1yf7gk4.png)

### ImageView の配置

次に画像を表示できるようにします。画像を表示するには ImageView という部品を使います。先程と同じように右ペイン下部から ImageView を選択し、先程追加したStackViewにドラッグアンドドロップします。

![](./images/20170801072357_img20170801-18-17e6n6x.png)

ImageView に対しても制約を追加します。
ImageViewの大きさを指定します。以下の画像のように設定してください。

![](./images/20170801072419_img20170801-18-ypel31.png)

ImageView を追加したら、右ペインの View の設定のところで Content Mode を `AspectFit` に切り替えてください。これにより、アスペクト比を保ったままImageViewの大きさに合わせて画像をリサイズして表示してくれます。

### Label の配置

次に投稿者名や投稿時間、本文を表示するラベルを配置します。

ImageView の隣に VerticalStackView を追加します。
その中に更に HorizontalView や Label を追加して、前述した木構造ができるようにしてください。

![](./images/20170801072449_img20170801-18-ii0bas.png)

ラベルが複数あるとわかりにくいので Label に表示するテキストを仮に入れておくと区別がつけやすくなります。ラベルをダブルクリックすると表示文字列を変更できます。

bodyLabel のみ、複数行に対応させる必要があるので lines の値を 0 にしてください。

![image-420769](./images/20170803061816_set_body_label_lines_zero.png)

3つのラベルを追加すると警告がでています。これは HorizontalStackView に追加した2つのラベルのうち、どちらを優先して表示すべきか iOS がわからないことを示しています。
そのため時刻を表示するラベルの方の設定を変更し、こちらを優先的に表示する設定を行います。

以下の画像のように、時刻表示ラベルを選択した状態で定規のようなタブを選択すると `ContentHuggingPriority` の設定項目が出てくるので Horizontal の値をデフォルトの `251` から `252` に変更してください。この数値が大きいほど優先してくれます。

![](./images/20170801072511_img20170801-13-hrw0pb.png)

ここまでの設定がすべてうまくいっていると、以下のような状態になります。

![](./images/20170801072541_img20170801-15-2hk7ti.png)

## クラスとセルの要素を結びつける

画像とラベルの配置ができたらこれらの要素をコードから参照できるように設定します。

画面右上部の円が重なっているようなアイコンのボタンを押して AssistantEditor を表示するようにすると Storyboard の画面とコードエディタを同時に表示できるようになります。エディタの上部でファイルが選択できるので、以下の画像の様に辿って `PostCell.swift` を表示します。

![](./images/20170801072601_img20170801-24-8btd1f.png)

Storyboard 上の imageView を選択した状態から Ctrl を押したままドラッグすると青い線が出ます。

この青い線を右側のソースコード上に落とすと、以下の画像の様に PostCell のメンバ変数と要素の接続の設定ができるダイアログが表示されるので、名前をつけてメンバ変数を追加します。
imageView は `avatarImageView` という名前にします。

![](./images/20170801072622_img20170801-15-ett6ry.png)
![](./images/20170801072635_img20170801-22-t83db1.png)

同様に他のラベル群に対しても設定を行うと、それぞれの要素にコードから参照できるようになります。
このような状態になれば完成です。

![](./images/20170801072650_img20170801-13-9zr3ue.png)